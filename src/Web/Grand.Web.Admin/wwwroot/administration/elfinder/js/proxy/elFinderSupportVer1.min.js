window.elFinderSupportVer1=function(e){"use strict";function l(e){return e.replace("Today",i).replace("Yesterday",r)}var r,a=this,t=new Date,i=t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate();t=new Date(Date.now()-864e5),r=t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate(),this.upload=e||"auto",this.init=function(e){this.fm=e,this.fm.parseUploadData=function(e){var r;if(!$.trim(e))return{error:["errResponse","errDataEmpty"]};try{r=JSON.parse(e)}catch(e){return{error:["errResponse","errDataNotJSON"]}}return a.normalize("upload",r)}},this.send=function(a){var t,r,e,i=this,n=this.fm,d=$.Deferred(),s=a.data.cmd;switch(d.abort=function(){"pending"==e.state()&&(e.quiet=!0,e.abort())},s){case"open":a.data.tree=1;break;case"parents":case"tree":return d.resolve({tree:[]});case"get":a.data.cmd="read",a.data.current=n.file(a.data.target).phash;break;case"put":a.data.cmd="edit",a.data.current=n.file(a.data.target).phash;break;case"archive":case"rm":a.data.current=n.file(a.data.targets[0]).phash;break;case"extract":case"rename":case"resize":a.data.current=n.file(a.data.target).phash;break;case"duplicate":return t=$.extend(!0,{},a),$.each(a.data.targets,function(e,r){$.ajax(Object.assign(t,{data:{cmd:"duplicate",target:r,current:n.file(r).phash}})).fail(function(e){n.error(n.res("error","connect"))}).done(function(e){(e=i.normalize("duplicate",e)).error?n.error(e.error):e.added&&n.trigger("add",{added:e.added})})}),d.resolve({});case"mkdir":case"mkfile":a.data.current=a.data.target;break;case"paste":a.data.current=a.data.dst,a.data.tree||$.each(a.data.targets,function(e,r){if(n.file(r)&&"directory"===n.file(r).mime)return!(a.data.tree="1")});break;case"size":case"search":return d.resolve({error:n.res("error","cmdsupport")});case"file":a.data.cmd="open",a.data.current=n.file(a.data.target).phash}return e=$.ajax(a).fail(function(e){d.reject(e)}).done(function(e){r=i.normalize(s,e),d.resolve(r)}),d},this.normalize=function(e,i){function r(e){return $.grep(e,function(e){return!(!e||!e.mime||"directory"!==e.mime)})}var n,a,t,d,s,o,c=this,h=this.fm,m={};return"tmb"==e||"get"==e?i:("upload"==e&&i.error&&i.cwd&&(i.warning=Object.assign({},i.error),i.error=!1),i.error?i:"put"==e?(n=h.file(i.target.hash).phash,{changed:[this.normalizeFile(i.target,n)]}):(t=(n=i.cwd.hash)==h.cwd().hash,i.tree&&$.each(this.normalizeTree(i.tree),function(e,r){m[r.hash]=r}),$.each(i.cdc||[],function(e,r){var a,t=r.hash;m[t]?(r.date&&((a=Date.parse(l(r.date)))&&!isNaN(a)?m[t].ts=Math.floor(a/1e3):m[t].date=r.date||h.formatDate(r)),m[t].locked=r.hash==n||void 0!==r.rm&&!r.rm):m[t]=c.normalizeFile(r,n,i.tmb)}),i.tree||$.each(h.files(),function(e,r){m[e]||r.phash==n||"directory"!=r.mime||(m[e]=r)}),"open"==e?{cwd:m[n]||this.normalizeFile(i.cwd),files:$.map(m,function(e){return e}),options:c.normalizeOptions(i),init:!!i.params,debug:i.debug}:(t?a=h.diff($.map(m,function(e){return e&&e.hash&&e.name&&e.mime?e:null})):i.tree&&"paste"!==e?(s=m,s=r(m),(d=h.diff(s,null,["date","ts"])).added.length&&(d.added=r(d.added)),d.changed.length&&(d.changed=r(d.changed)),d.removed.length&&(o=[],$.each(d.removed,function(e,r){var a;(a=h.file(r))&&"directory"===a.mime&&o.push(r)}),d.removed=o),a=d):(a={added:[],removed:[],changed:[]},"paste"===e&&(a.sync=!0)),Object.assign({current:i.cwd.hash,error:i.error,warning:i.warning,options:{tmb:!!i.tmb}},a))))},this.normalizeTree=function(e){var i=this,n=[],d=function(e,r){for(var a,t=0;t<e.length;t++)a=e[t],n.push(i.normalizeFile(a,r)),a.dirs.length&&d(a.dirs,a.hash)};return d([e]),n},this.normalizeFile=function(e,r,a){var t=e.mime||"directory",i="directory"!=t||e.linkTo?e.size:0,n=e.date?Date.parse(l(e.date)):void 0,r={url:e.url,hash:e.hash,phash:r,name:e.name,mime:t,ts:e.ts,size:i,read:e.read,write:e.write,locked:!r||void 0!==e.rm&&!e.rm};return r.ts||(n&&!isNaN(n)?r.ts=Math.floor(n/1e3):r.date=e.date||this.fm.formatDate(e)),"application/x-empty"!=e.mime&&"inode/x-empty"!=e.mime||(r.mime="text/plain"),e.linkTo&&(r.alias=e.linkTo),e.linkTo&&(r.linkTo=e.linkTo),e.tmb?r.tmb=e.tmb:0===r.mime.indexOf("image/")&&a&&(r.tmb=1),e.dirs&&e.dirs.length&&(r.dirs=!0),e.dim&&(r.dim=e.dim),e.resize&&(r.resize=e.resize),r},this.normalizeOptions=function(e){var r={path:e.cwd.rel,disabled:$.merge(e.disabled||[],["search","netmount","zipdl"]),tmb:!!e.tmb,copyOverwrite:!0};return e.params&&(r.api=1,r.url=e.params.url,r.archivers={create:e.params.archives||[],extract:e.params.extract||[]}),-1!==r.path.indexOf("/")?r.separator="/":-1!==r.path.indexOf("\\")&&(r.separator="\\"),r}};